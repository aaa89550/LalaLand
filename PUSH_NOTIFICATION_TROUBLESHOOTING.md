# 🔧 推播通知權限問題排除指南

## 🚨 常見權限被拒絕原因

### 1. **瀏覽器已拒絕權限**
- **症狀**: 點擊開關後顯示「權限被拒絕」
- **原因**: 之前曾經拒絕過通知權限
- **解決**: 需要手動重設瀏覽器權限

### 2. **非 HTTPS 環境**
- **症狀**: 顯示「需要 HTTPS 環境」
- **原因**: 推播通知只在 HTTPS 或 localhost 下運作
- **解決**: 確保使用 https:// 訪問網站

### 3. **瀏覽器不支援**
- **症狀**: 顯示「瀏覽器不支援推播通知」
- **原因**: 舊版瀏覽器或特殊環境
- **解決**: 更新瀏覽器或使用支援的瀏覽器

## 🛠️ 重設權限步驟

### Chrome
1. 點擊網址列左側的 🔒 或ℹ️ 圖示
2. 點擊「網站設定」
3. 找到「通知」設定
4. 選擇「允許」
5. 重新整理頁面

### Firefox  
1. 點擊網址列左側的 🔒 圖示
2. 點擊 ➤ 符號
3. 找到「通知」權限
4. 選擇「允許」
5. 重新整理頁面

### Safari
1. Safari 選單 → 偏好設定
2. 點擊「網站」標籤
3. 選擇左側「通知」
4. 找到您的網站
5. 選擇「允許」

### Edge
1. 點擊網址列左側的 🔒 圖示  
2. 點擊「權限」
3. 找到「通知」
4. 選擇「允許」
5. 重新整理頁面

## 🔍 使用內建診斷工具

### 應用程式內診斷
1. 進入聊天室設定 ⚙️
2. 找到「推播通知 (FCM)」區塊  
3. 點擊「🔍 環境檢查」按鈕
4. 查看診斷結果

### 診斷項目說明
- ✅ **HTTPS**: 必須為 https:// 或 localhost
- ✅ **Service Worker**: 瀏覽器必須支援
- ✅ **推播管理**: PushManager API 支援
- ✅ **通知 API**: Notification API 支援  
- ✅ **Firebase Messaging**: FCM 初始化狀態
- 📋 **權限狀態**: granted/denied/default

## 📱 瀏覽器相容性

### ✅ 完全支援
- Chrome 50+ (桌面/Android)
- Firefox 44+ (桌面/Android) 
- Edge 17+ (桌面)
- Samsung Internet 4+

### ⚠️ 部分支援  
- Safari 16+ (macOS 13+, 限制較多)
- Opera 37+ (基於 Chrome)

### ❌ 不支援
- iOS Safari (Apple 政策限制)
- 某些企業瀏覽器
- 無痕/私密模式 (部分瀏覽器)

## 🐛 進階排除

### 檢查控制台錯誤
1. 按 F12 開啟開發者工具
2. 查看 Console 標籤
3. 尋找紅色錯誤訊息
4. 特別注意 FCM、Service Worker 相關錯誤

### 清除瀏覽器快取
1. Chrome: Ctrl+Shift+Delete
2. 選擇「所有時間」
3. 勾選「快取圖片和檔案」
4. 點擊「清除資料」
5. 重新造訪網站

### Service Worker 重新註冊
1. F12 → Application → Service Workers  
2. 找到您的網站
3. 點擊「Unregister」
4. 重新整理頁面

## 🆘 還是無法解決？

### 使用內建指引
1. 點擊「📖 權限指引」按鈮
2. 按照步驟操作
3. 如需協助，提供「🔍 環境檢查」結果

### 替代方案
- 使用「桌面通知」功能
- 使用「內部通知泡泡」
- 開啟瀏覽器聲音提醒

### 聯絡支援時請提供
- 瀏覽器名稱和版本
- 作業系統
- 環境檢查結果  
- 控制台錯誤訊息

---

💡 **提示**: 推播通知是進階功能，即使無法啟用，您仍可使用完整的聊天功能和其他通知方式！